<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gully Cricket</title>
    <link rel="stylesheet" href="../static/style/bootstrap.min.css">
    <link rel="stylesheet" href="../static/style/style.css">
    //- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
    <div class="container">
        <h1 class="text-center">Gully Cricket</h1>
        <div class="row">
            <div class="col-12">
                <h2 class="text-center">Game Over</h2>
                <h3 class="text-center" id='won'></h3>
                <h3 class="text-center"><span id="team1"></span> Score: <span id="run1"></span>/<span id="wickets1"></span></h3>
                <h3 class="text-center"><span id="team2"></span> Score: <span id="run2"></span>/<span id="wickets2"></span></h3>
                <div id="battingStats" style="display: flex; flex-direction: column;">
                </div>
                <div class="bowlersStats">
                    <h3 class="text-center" id='BowlerHeading'></h3>
                    <div class="d-flex flex-column gap-4">
                        <div class="d-flex align-items-center gap-3">
                            <div class="d-flex" id="every-ball" style='flex-direction:column; justify-content:center;'>
                            
                            </div>
                        </div>
                    </div>
                </div>
                <div class="defendingteamBatting">
                    <h3 class="text-center">Defending Team Batting Stats</h3>
                    <div class="d-flex flex-column gap-4">
                        <div class="d-flex align-items-center gap-3">
                            <div class="d-flex" id="defendingteamBattingStats" style='flex-direction:column; justify-content:center;'>
                            
                            </div>
                        </div>
                    </div>
                </div>
                <div class="attackingteamBowling">
                    <h3 class="text-center">Chashing Team Batting Stats</h3>
                    <div class="d-flex flex-column gap-4">
                        <div class="d-flex align-items-center gap-3">
                            <div class="d-flex" id="attackingteamBowlingStats" style='flex-direction:column; justify-content:center;'>
                            
                            </div>
                        </div>
                    </div>
                <div class="text-center">
                    <button id='saveMatch' class="btn btn-primary">Save the match</button>
                </div>
            </div>
        </div>
    </div>
    <script src="../static/style/bootstrap.bundle.min.js"></script>
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script> -->
script.
    const team1name = document.getElementById('team1');
    const team1run = document.getElementById('run1');
    const team1wickets = document.getElementById('wickets1');
    const everyBall = document.getElementById('every-ball');
    const BowlerHeading = document.getElementById('BowlerHeading');
    const battingStats = document.getElementById('battingStats');

    const team2name = document.getElementById('team2');
    const team2run = document.getElementById('run2');
    const team2wickets = document.getElementById('wickets2');
    const team1 = JSON.parse(localStorage.getItem('team1Score'));
    const team2 = JSON.parse(localStorage.getItem('team2Score'));
    const AllBowlers = JSON.parse(localStorage.getItem('AllBowlers'));
    const tossLossingBattingStats = JSON.parse(localStorage.getItem('tossLossingBattingStats'));
    const tossWinningBattingStats = JSON.parse(localStorage.getItem('tossWinningBattingStats'));
    const defendingteamBattingStats = document.getElementById('defendingteamBattingStats');
    const attackingteamBowlingStats = document.getElementById('attackingteamBowlingStats');

    var numberOfPlayers = !{number};
    var playersName = !{JSON.stringify(players)};
    var toss = "!{toss}";
    console.log("Defending Team Batting Stats:", tossLossingBattingStats);
    console.log("Attacking Team Bowling Stats:", tossWinningBattingStats);
    console.log("All Bowlers Data:", AllBowlers);
    console.log("Players Name:", playersName);

    for (let i = 0; i < numberOfPlayers; i++) {
        let newDiv = document.createElement('div');
        newDiv.style.display = 'flex';
        newDiv.style.alignItems = 'center';
        newDiv.style.width = '100%';

        let playerSpan = document.createElement('span');
        playerSpan.innerHTML = `${playersName[i]}`;
        newDiv.appendChild(playerSpan);
        let pla = `${playersName[i]}`;
        console.log("Player Name: ",pla)
        let playerStat = tossLossingBattingStats[pla] || tossWinningBattingStats[pla];

        console.log("Here are the players stats: ",playerStat);
        if (playerStat) {
            for (let j = 0; j < 4; j++) {
                let newSpan = document.createElement('span');
                newSpan.className = 'd-flex justify-content-center align-items-center rounded-circle bg-secondary text-white';
                newSpan.style.height = '2.75rem';
                newSpan.style.width = '2.75rem';
                newSpan.innerHTML = playerStat[j];
                newDiv.appendChild(newSpan);
            }
        }else {
            console.error("Stats not found for player: ", pla);
        }
        defendingteamBattingStats.appendChild(newDiv);
    }
    for (let i = 0; i < numberOfPlayers; i++) {
    let newDiv = document.createElement('div');
    newDiv.style.display = 'flex';
    newDiv.style.alignItems = 'center';
    newDiv.style.width = '100%';

    let pla = `${playersName[i + numberOfPlayers]}`;
    let playerStat = tossLossingBattingStats[pla] || tossWinningBattingStats[pla];
    console.log("Player Name: ", pla);
    console.log("Here are the players stats: ", playerStat);
    let playerSpan = document.createElement('span');
        playerSpan.innerHTML = `${playersName[i+numberOfPlayers]}`;
        newDiv.appendChild(playerSpan);

    if (playerStat) {
        for (let j = 0; j < 4; j++) {
            let newSpan = document.createElement('span');
            newSpan.className = 'd-flex justify-content-center align-items-center rounded-circle bg-secondary text-white';
            newSpan.style.height = '2.75rem';
            newSpan.style.width = '2.75rem';
            newSpan.innerHTML = playerStat[j];
            newDiv.appendChild(newSpan);
        }
        } else {
            console.error("Stats not found for player: ", pla);
        }
        attackingteamBowlingStats.appendChild(newDiv);
    }

    if (team1[1] > team2[1] && team1[0] === toss) {
        document.getElementById('won').innerText = `${team1[0]} won by ${team1[1] - team2[1]} runs`;
    } else if (team1[1] < team2[1] && team2[0] === toss){
        document.getElementById('won').innerText = `${team2[0]} won by ${team2[1] - team1[1]} runs`;
    }
    else if(team1[1] > team2[1] && team2[0] === toss){
        document.getElementById('won').innerText = `${team1[0]} won by ${numberOfPlayers - team1[2]} wickets`;
    }
    else if(team1[1] < team2[1] && team1[0] === toss){
        document.getElementById('won').innerText = `${team2[0]} won by ${numberOfPlayers - team2[2]} wickets`;
    }
    else if(team1[1] === team2[1]){
        document.getElementById('won').innerText = `Match Draw`;
    }

    for (let i = 0; i < AllBowlers.length; i++) {
        let newDiv = document.createElement('div');
        newDiv.style.display = 'flex';
        newDiv.style.alignItems = 'center';
        newDiv.style.width = '100%';

        let BowlerSpan = document.createElement('span');
        BowlerSpan.innerHTML = `${AllBowlers[i]}`
        newDiv.appendChild(BowlerSpan);
        let bowlerStat = JSON.parse(localStorage.getItem(AllBowlers[i]));
        for (let j = 0; j < bowlerStat.length; j++) {
            let newSpan = document.createElement('span');
            newSpan.className = 'd-flex justify-content-center align-items-center rounded-circle bg-secondary text-white';
            newSpan.style.height = '2.75rem';
            newSpan.style.width = '2.75rem';
            newSpan.innerHTML = bowlerStat[j];
            newDiv.appendChild(newSpan);
        }
        everyBall.appendChild(newDiv);
    }
    team1name.innerText = team1[0];
    team1run.innerText = team1[1];
    team1wickets.innerText = team1[2];
    team2name.innerText = team2[0];
    team2run.innerText = team2[1];
    team2wickets.innerText = team2[2];

    function saveMatchData(data) {
    data.uniqueId = new Date().toISOString();

    fetch('/save-match-data', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
    })
        .then(response => response.json())
        .then(data => console.log('Success:', data))
        .catch((error) => console.error('Error:', error));
    }

    //- const matchData = {
    //-     team1: { score: 250, wickets: 8 },
    //-     team2: { score: 245, wickets: 10 },
    //-     winner: 'team1',
    //-     // Add more match details as needed
    //- };
    var winTeam;
    var lossTeam;
    if(toss === team1[0]){
        winTeam = team1[0];
        lossTeam = team2[0];
    }
    else{
        winTeam = team2[0];
        lossTeam = team1[0];
    }
    const matchData = {
        team1: {name: winTeam, score: team1[1], wickets: team1[2], players: tossWinningBattingStats, bowlers: AllBowlers, bowlersStats: tossWinningBattingStats},
        team2: {name: lossTeam, score: team2[1], wickets: team2[2], players: tossLossingBattingStats, bowlers: AllBowlers, bowlersStats: tossLossingBattingStats},
        winner: document.getElementById('won').innerText,
        players: playersName,
        toss: toss,
        number: numberOfPlayers,
    };
    
    document.getElementById('saveMatch').addEventListener('click', () => {
        saveMatchData(matchData);
        alert('data saved')
    });
    //- saveMatchData(matchData);

</body>
</html>